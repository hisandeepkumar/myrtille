<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Myrtille Industries - Invoice Generator</title>
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      color: #f0f0f0;
      background: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('https://4kwallpapers.com/images/wallpapers/macos-big-sur-apple-layers-fluidic-colorful-wwdc-stock--1455.jpg');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      padding: 20px;
    }

    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    @media (max-width: 1024px) {
      .main-container {
        grid-template-columns: 1fr;
      }
    }

    /* Form Container */
    .form-container {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(16px);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), 0 4px 16px rgba(255, 255, 255, 0.1), inset 0 1px 2px rgba(255, 255, 255, 0.3);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 30px;
    }

    .header {
      padding-bottom: 24px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      margin-bottom: 24px;
    }

    .header h1 {
      font-size: 28px;
      font-weight: 600;
      color: #f0f0f0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }

    .header h1 i {
      color: #5b86e5;
      font-size: 28px;
    }

    .header p {
      color: rgba(255, 255, 255, 0.8);
      margin-top: 8px;
      font-size: 16px;
    }

    /* Form Styles */
    .form-section {
      margin-bottom: 30px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: #5b86e5;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title i {
      font-size: 18px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    .form-group {
      margin-bottom: 18px;
    }

    .form-group label {
      display: block;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 500;
    }

    .form-group input, .form-group textarea, .form-group select {
      width: 100%;
      padding: 14px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.15);
      color: #fff;
      font-size: 15px;
      transition: all 0.3s ease;
    }

    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      outline: none;
      border-color: #5b86e5;
      box-shadow: 0 0 0 2px rgba(91, 134, 229, 0.3);
      background: rgba(255, 255, 255, 0.2);
    }

    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* Items Table */
    .items-table-container {
      overflow-x: auto;
      margin-bottom: 20px;
    }

    .items-table {
      width: 100%;
      border-collapse: collapse;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
    }

    .items-table th {
      background: rgba(91, 134, 229, 0.3);
      color: #fff;
      font-weight: 600;
      padding: 14px 12px;
      text-align: left;
      font-size: 14px;
    }

    .items-table td {
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .items-table input {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.15);
      color: #fff;
    }

    .items-table input:focus {
      outline: none;
      border-color: #5b86e5;
    }

    .item-actions {
      display: flex;
      gap: 8px;
    }

    /* Buttons */
    .btn {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(12px);
      color: #f0f0f0;
      border: 1px solid rgba(255, 255, 255, 0.4);
      padding: 14px 24px;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      box-shadow: 0 8px 24px rgba(91, 134, 229, 0.4), 0 4px 12px rgba(0, 0, 0, 0.2), inset 0 2px 4px rgba(255, 255, 255, 0.3);
    }

    .btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 12px 32px rgba(91, 134, 229, 0.5), 0 6px 16px rgba(0, 0, 0, 0.3), inset 0 2px 4px rgba(255, 255, 255, 0.4);
    }

    .btn-primary {
      background: rgba(91, 134, 229, 0.7);
      border-color: #5b86e5;
    }

    .btn-primary:hover {
      background: rgba(91, 134, 229, 0.9);
    }

    .btn-secondary {
      background: rgba(52, 199, 89, 0.3);
      border-color: #34c759;
    }

    .btn-secondary:hover {
      background: rgba(52, 199, 89, 0.5);
    }

    .btn-danger {
      background: rgba(255, 59, 48, 0.3);
      border-color: #ff3b30;
    }

    .btn-danger:hover {
      background: rgba(255, 59, 48, 0.5);
    }

    .btn-small {
      padding: 8px 12px;
      font-size: 13px;
    }

    .button-group {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    /* Preview Container */
    .preview-container {
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(16px);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2), 0 4px 16px rgba(255, 255, 255, 0.1), inset 0 1px 2px rgba(255, 255, 255, 0.3);
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: 30px;
      display: flex;
      flex-direction: column;
    }

    .preview-header {
      text-align: center;
      margin-bottom: 24px;
    }

    .preview-header h2 {
      font-size: 24px;
      font-weight: 600;
      color: #f0f0f0;
      margin-bottom: 8px;
    }

    .preview-header p {
      color: rgba(255, 255, 255, 0.8);
    }

    .preview-content {
      flex: 1;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 24px;
      overflow-y: auto;
      max-height: 600px;
    }

    .invoice-preview {
      background: white;
      color: #333;
      border-radius: 8px;
      padding: 24px;
      font-family: 'Inter', sans-serif;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .company-header {
      text-align: center;
      margin-bottom: 24px;
      border-bottom: 2px solid #5b86e5;
      padding-bottom: 16px;
    }

    .company-header h2 {
      color: #2c3e50;
      font-size: 28px;
      margin-bottom: 8px;
    }

    .company-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 24px;
    }

    .company-info, .bill-to {
      padding: 16px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .company-info h3, .bill-to h3 {
      color: #5b86e5;
      margin-bottom: 12px;
      font-size: 18px;
    }

    .invoice-title {
      text-align: center;
      font-size: 24px;
      margin: 20px 0;
      color: #2c3e50;
      text-decoration: underline;
    }

    .invoice-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }

    .invoice-table th {
      background: #5b86e5;
      color: white;
      padding: 12px;
      text-align: left;
      font-weight: 600;
    }

    .invoice-table td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
    }

    .invoice-totals {
      margin-top: 24px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .amount-words {
      margin: 20px 0;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 6px;
      font-style: italic;
    }

    .terms {
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px dashed #ccc;
      font-size: 14px;
    }

    .signature-section {
      margin-top: 30px;
      text-align: right;
    }

    .signature-placeholder {
      display: inline-block;
      width: 200px;
      height: 60px;
      background: #f8f9fa;
      border: 1px dashed #5b86e5;
      border-radius: 4px;
      position: relative;
    }

    .signature-placeholder::after {
      content: "Signature";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #888;
      font-style: italic;
    }

    /* Status Messages */
    .status-area {
      display: none;
      margin-top: 24px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .status-area.active {
      display: block;
    }

    .status-header {
      display: flex;
      align-items: center;
      margin-bottom: 16px;
    }

    .status-header i {
      margin-right: 12px;
      color: #5b86e5;
      font-size: 20px;
    }

    .status-header h3 {
      font-size: 18px;
      font-weight: 500;
      color: #f0f0f0;
    }

    .progress-container {
      background: rgba(255, 255, 255, 0.1);
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-bar {
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, #5b86e5, #36d1dc);
      transition: width 0.3s ease;
      border-radius: 4px;
    }

    .status-message {
      margin-top: 12px;
      font-size: 14px;
      color: rgba(255, 255, 255, 0.8);
    }

    .success-message, .error-message {
      display: none;
      padding: 16px;
      border-radius: 12px;
      font-size: 14px;
      text-align: center;
      margin-top: 24px;
    }

    .success-message {
      background: rgba(52, 199, 89, 0.2);
      color: #34c759;
      border: 1px solid rgba(52, 199, 89, 0.3);
    }

    .error-message {
      background: rgba(255, 59, 48, 0.2);
      color: #ff3b30;
      border: 1px solid rgba(255, 59, 48, 0.3);
    }

    .success-message i, .error-message i {
      margin-right: 8px;
    }

    /* Back Button */
    .back-button {
      position: fixed;
      top: 16px;
      left: 16px;
      z-index: 2147483647;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.55), rgba(255, 255, 255, 0.15));
      backdrop-filter: blur(14px) saturate(160%);
      -webkit-backdrop-filter: blur(14px) saturate(160%);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.18), inset 0 1px 1px rgba(255, 255, 255, 0.7);
      transition: transform .35s cubic-bezier(.2, .8, .2, 1), box-shadow .35s cubic-bezier(.2, .8, .2, 1);
      overflow: hidden;
      -webkit-tap-highlight-color: transparent;
    }

    .back-button:hover {
      transform: translateY(-4px) scale(1.05);
      box-shadow: 0 18px 45px rgba(0, 0, 0, .28), inset 0 1px 1px rgba(255, 255, 255, .85);
    }

    .back-button:hover svg {
      transform: rotate(360deg);
    }

    .back-button svg {
      position: relative;
      z-index: 2;
      transition: transform .35s ease;
    }

    .back-button span {
      position: absolute;
      inset: -6px;
      border-radius: 50%;
      background: conic-gradient(from 0deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, .6), rgba(255, 255, 255, 0));
      filter: blur(8px);
      opacity: .6;
      animation: spin 6s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Back Button -->
  <button class="back-button" onclick="history.back()">
    <span></span>
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M15 18l-6-6 6-6" stroke="rgba(20,20,20,.9)" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </button>

  <div class="main-container">
    <!-- Form Section -->
    <div class="form-container">
      <div class="header">
        <h1><i class="fas fa-file-invoice"></i> Myrtille Industries Invoice Generator</h1>
        <p>Fill in the details below to generate a professional invoice</p>
      </div>

      <form id="invoiceForm">
        <!-- Company Details -->
        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-building"></i>
            <span>Company Details</span>
          </div>
          
          <div class="form-group">
            <label for="invoiceNumber">Invoice Number</label>
            <input type="text" id="invoiceNumber" value="INV-2024-001" required>
          </div>
          
          <div class="form-group">
            <label for="invoiceDate">Invoice Date</label>
            <input type="date" id="invoiceDate" required>
          </div>
        </div>

        <!-- Bill To Section -->
        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-user-tie"></i>
            <span>Bill To</span>
          </div>
          
          <div class="form-group">
            <label for="customerName">Customer Name</label>
            <input type="text" id="customerName" value="SUPERINTENDENT CUM MEMBER SECRETARY RMRS" required>
          </div>
          
          <div class="form-group">
            <label for="customerAddress">Customer Address</label>
            <textarea id="customerAddress" required>SUPER SPECIALITY HOSPITAL, RNT MEDICAL COLLEGE, UDAIPUR</textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="customerContact">Contact No.</label>
              <input type="text" id="customerContact" value="9829851042" required>
            </div>
            
            <div class="form-group">
              <label for="customerGST">Customer GSTIN (Optional)</label>
              <input type="text" id="customerGST">
            </div>
          </div>
        </div>

        <!-- Items Section -->
        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-list"></i>
            <span>Invoice Items</span>
          </div>
          
          <div class="items-table-container">
            <table class="items-table" id="itemsTable">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Item Name</th>
                  <th>HSN/SAC</th>
                  <th>Quantity</th>
                  <th>Price/Unit (₹)</th>
                  <th>GST %</th>
                  <th>Amount (₹)</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="itemsTableBody">
                <!-- Items will be added here dynamically -->
              </tbody>
            </table>
          </div>
          
          <button type="button" class="btn btn-secondary" id="addItemBtn">
            <i class="fas fa-plus"></i> Add Item
          </button>
        </div>

        <!-- Terms & Conditions -->
        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-file-contract"></i>
            <span>Terms & Conditions</span>
          </div>
          
          <div class="form-group">
            <label for="terms">Terms and Conditions</label>
            <textarea id="terms">Thank you for doing business with us.</textarea>
          </div>
        </div>

        <!-- Payment Details -->
        <div class="form-section">
          <div class="section-title">
            <i class="fas fa-rupee-sign"></i>
            <span>Payment Details</span>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="amountReceived">Amount Received (₹)</label>
              <input type="number" id="amountReceived" value="0" min="0" step="0.01">
            </div>
            
            <div class="form-group">
              <label for="paymentMode">Payment Mode</label>
              <select id="paymentMode">
                <option value="Bank Transfer">Bank Transfer</option>
                <option value="Cash">Cash</option>
                <option value="Cheque">Cheque</option>
                <option value="Online">Online</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="button-group">
          <button type="button" class="btn btn-primary" id="generateInvoiceBtn">
            <i class="fas fa-file-pdf"></i> Generate Invoice PDF
          </button>
          
          <button type="button" class="btn" id="previewInvoiceBtn">
            <i class="fas fa-eye"></i> Preview Invoice
          </button>
          
          <button type="button" class="btn btn-danger" id="resetFormBtn">
            <i class="fas fa-redo"></i> Reset Form
          </button>
        </div>
      </form>

      <!-- Status Area -->
      <div class="status-area" id="statusArea">
        <div class="status-header">
          <i class="fas fa-cog fa-spin"></i>
          <h3>Processing your invoice...</h3>
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="status-message" id="statusMessage">Initializing PDF generation...</div>
      </div>

      <!-- Success/Error Messages -->
      <div class="success-message" id="successMessage">
        <i class="fas fa-check-circle"></i> Invoice generated successfully!
      </div>
      
      <div class="error-message" id="errorMessage">
        <i class="fas fa-exclamation-circle"></i> <span id="errorText">Error generating invoice</span>
      </div>
    </div>

    <!-- Preview Section -->
    <div class="preview-container">
      <div class="preview-header">
        <h2>Invoice Preview</h2>
        <p>Live preview of your invoice</p>
      </div>
      
      <div class="preview-content">
        <div class="invoice-preview" id="invoicePreview">
          <!-- Invoice preview will be rendered here -->
        </div>
      </div>
      
      <div class="button-group" style="margin-top: 20px;">
        <button type="button" class="btn btn-primary" id="downloadPreviewBtn" style="display: none;">
          <i class="fas fa-download"></i> Download PDF
        </button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize date field with today's date
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('invoiceDate').value = today;
      
      // Add initial item row
      addItemRow();
      
      // Set up event listeners
      document.getElementById('addItemBtn').addEventListener('click', addItemRow);
      document.getElementById('generateInvoiceBtn').addEventListener('click', generateInvoicePDF);
      document.getElementById('previewInvoiceBtn').addEventListener('click', previewInvoice);
      document.getElementById('resetFormBtn').addEventListener('click', resetForm);
      document.getElementById('downloadPreviewBtn').addEventListener('click', generateInvoicePDF);
      
      // Add sample data for demo
      addSampleData();
    });
    
    // Function to add a new item row
    function addItemRow(itemData = {}) {
      const tbody = document.getElementById('itemsTableBody');
      const rowCount = tbody.children.length + 1;
      
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${rowCount}</td>
        <td><input type="text" class="item-name" value="${itemData.name || ''}" placeholder="Item name"></td>
        <td><input type="text" class="item-hsn" value="${itemData.hsn || ''}" placeholder="HSN/SAC code"></td>
        <td><input type="number" class="item-quantity" value="${itemData.quantity || 1}" min="1" step="1"></td>
        <td><input type="number" class="item-price" value="${itemData.price || 0}" min="0" step="0.01"></td>
        <td>
          <select class="item-gst">
            <option value="0" ${itemData.gst === 0 ? 'selected' : ''}>0%</option>
            <option value="5" ${itemData.gst === 5 ? 'selected' : ''}>5%</option>
            <option value="12" ${itemData.gst === 12 ? 'selected' : ''}>12%</option>
            <option value="18" ${itemData.gst === 18 ? 'selected' : ''}>18%</option>
            <option value="28" ${itemData.gst === 28 ? 'selected' : ''}>28%</option>
          </select>
        </td>
        <td class="item-amount">₹ 0.00</td>
        <td>
          <div class="item-actions">
            <button type="button" class="btn btn-small" onclick="calculateItemAmount(this)">
              <i class="fas fa-calculator"></i>
            </button>
            <button type="button" class="btn btn-small btn-danger" onclick="removeItemRow(this)">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </td>
      `;
      
      tbody.appendChild(row);
      
      // Add event listeners to inputs for auto-calculation
      const inputs = row.querySelectorAll('.item-quantity, .item-price, .item-gst');
      inputs.forEach(input => {
        input.addEventListener('input', () => calculateItemAmount(row));
      });
      
      // Calculate initial amount
      calculateItemAmount(row);
    }
    
    // Function to calculate item amount
    function calculateItemAmount(element) {
      const row = element.closest ? element.closest('tr') : element;
      const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
      const price = parseFloat(row.querySelector('.item-price').value) || 0;
      const gst = parseFloat(row.querySelector('.item-gst').value) || 0;
      
      const subtotal = quantity * price;
      const gstAmount = subtotal * (gst / 100);
      const total = subtotal + gstAmount;
      
      row.querySelector('.item-amount').textContent = `₹ ${total.toFixed(2)}`;
      
      // Update the row number if needed
      updateRowNumbers();
      
      // Update preview if it's visible
      if (document.getElementById('downloadPreviewBtn').style.display !== 'none') {
        previewInvoice();
      }
    }
    
    // Function to remove an item row
    function removeItemRow(button) {
      const row = button.closest('tr');
      row.remove();
      updateRowNumbers();
      
      // Update preview if it's visible
      if (document.getElementById('downloadPreviewBtn').style.display !== 'none') {
        previewInvoice();
      }
    }
    
    // Function to update row numbers
    function updateRowNumbers() {
      const rows = document.querySelectorAll('#itemsTableBody tr');
      rows.forEach((row, index) => {
        row.querySelector('td:first-child').textContent = index + 1;
      });
    }
    
    // Function to calculate invoice totals
    function calculateInvoiceTotals() {
      const rows = document.querySelectorAll('#itemsTableBody tr');
      let subtotal = 0;
      let totalGST = 0;
      let totalAmount = 0;
      
      rows.forEach(row => {
        const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
        const price = parseFloat(row.querySelector('.item-price').value) || 0;
        const gst = parseFloat(row.querySelector('.item-gst').value) || 0;
        
        const itemSubtotal = quantity * price;
        const itemGST = itemSubtotal * (gst / 100);
        const itemTotal = itemSubtotal + itemGST;
        
        subtotal += itemSubtotal;
        totalGST += itemGST;
        totalAmount += itemTotal;
      });
      
      return {
        subtotal: subtotal.toFixed(2),
        totalGST: totalGST.toFixed(2),
        totalAmount: totalAmount.toFixed(2)
      };
    }
    
    // Function to convert number to words
    function numberToWords(num) {
      const a = ['', 'one ', 'two ', 'three ', 'four ', 'five ', 'six ', 'seven ', 'eight ', 'nine ', 'ten ', 'eleven ', 'twelve ', 'thirteen ', 'fourteen ', 'fifteen ', 'sixteen ', 'seventeen ', 'eighteen ', 'nineteen '];
      const b = ['', '', 'twenty', 'thirty', 'forty', 'fifty', 'sixty', 'seventy', 'eighty', 'ninety'];
      
      const number = parseFloat(num);
      const rupees = Math.floor(number);
      const paisa = Math.round((number - rupees) * 100);
      
      let rupeesWords = '';
      let paisaWords = '';
      
      if (rupees === 0) {
        rupeesWords = 'Zero';
      } else if (rupees < 20) {
        rupeesWords = a[rupees];
      } else if (rupees < 100) {
        rupeesWords = b[Math.floor(rupees / 10)] + (rupees % 10 !== 0 ? ' ' + a[rupees % 10] : '');
      } else if (rupees < 1000) {
        rupeesWords = a[Math.floor(rupees / 100)] + 'hundred ' + numberToWords(rupees % 100);
      } else if (rupees < 100000) {
        rupeesWords = numberToWords(Math.floor(rupees / 1000)) + 'thousand ' + numberToWords(rupees % 1000);
      } else if (rupees < 10000000) {
        rupeesWords = numberToWords(Math.floor(rupees / 100000)) + 'lakh ' + numberToWords(rupees % 100000);
      } else {
        rupeesWords = numberToWords(Math.floor(rupees / 10000000)) + 'crore ' + numberToWords(rupees % 10000000);
      }
      
      if (paisa > 0) {
        if (paisa < 20) {
          paisaWords = a[paisa];
        } else {
          paisaWords = b[Math.floor(paisa / 10)] + (paisa % 10 !== 0 ? ' ' + a[paisa % 10] : '');
        }
      }
      
      let result = rupeesWords.trim().charAt(0).toUpperCase() + rupeesWords.trim().slice(1) + ' Rupees';
      
      if (paisa > 0) {
        result += ' and ' + paisaWords.trim() + ' Paisa';
      }
      
      return result + ' only';
    }
    
    // Function to preview invoice
    function previewInvoice() {
      const totals = calculateInvoiceTotals();
      const amountReceived = parseFloat(document.getElementById('amountReceived').value) || 0;
      const balance = parseFloat(totals.totalAmount) - amountReceived;
      
      // Generate invoice HTML for preview
      const invoiceHTML = `
        <div class="company-header">
          <h2>Myrtille Industries</h2>
          <p>25 Deep Nagar, Near Gurjar ki Thari Jaipur (Raj) 302019</p>
          <p>A/C NO. 921020038756944 | IFSC CODE UTIB0002582 | Axis bank Swej farm Jaipur</p>
          <p>Phone no.: 9782099489 | Email: myrtilleindia@gmail.com</p>
          <p>GSTIN: 08AMHPY5013C1Z4 | State: 08-Rajasthan</p>
        </div>
        
        <div class="invoice-title">Tax Invoice</div>
        
        <div class="company-details">
          <div class="company-info">
            <h3>Myrtille Industries</h3>
            <p>25 Deep Nagar, Near Gurjar ki Thari</p>
            <p>Jaipur (Raj) 302019</p>
            <p>GSTIN: 08AMHPY5013C1Z4</p>
            <p>State: 08-Rajasthan</p>
          </div>
          
          <div class="bill-to">
            <h3>Bill To</h3>
            <p><strong>${document.getElementById('customerName').value}</strong></p>
            <p>${document.getElementById('customerAddress').value}</p>
            <p>Contact No.: ${document.getElementById('customerContact').value}</p>
            ${document.getElementById('customerGST').value ? `<p>GSTIN: ${document.getElementById('customerGST').value}</p>` : ''}
          </div>
        </div>
        
        <table class="invoice-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Item name</th>
              <th>HSN/ SAC</th>
              <th>Quantity</th>
              <th>Price/ unit</th>
              <th>GST</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody>
            ${generateInvoiceItemsHTML()}
          </tbody>
        </table>
        
        <div class="invoice-totals">
          <div>
            <div class="amount-words">
              <strong>Invoice Amount In Words:</strong><br>
              ${numberToWords(totals.totalAmount)}
            </div>
            
            <div class="terms">
              <strong>Terms and Conditions</strong><br>
              ${document.getElementById('terms').value}
            </div>
          </div>
          
          <div>
            <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
              <tr>
                <td style="padding: 8px; border-bottom: 1px solid #ddd;">Sub Total</td>
                <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">₹ ${totals.subtotal}</td>
              </tr>
              <tr>
                <td style="padding: 8px; border-bottom: 1px solid #ddd;">SGST @9%</td>
                <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">₹ ${(parseFloat(totals.totalGST) / 2).toFixed(2)}</td>
              </tr>
              <tr>
                <td style="padding: 8px; border-bottom: 1px solid #ddd;">CGST @9%</td>
                <td style="padding: 8px; border-bottom: 1px solid #ddd; text-align: right;">₹ ${(parseFloat(totals.totalGST) / 2).toFixed(2)}</td>
              </tr>
              <tr>
                <td style="padding: 8px; border-bottom: 2px solid #5b86e5;"><strong>Total</strong></td>
                <td style="padding: 8px; border-bottom: 2px solid #5b86e5; text-align: right;"><strong>₹ ${totals.totalAmount}</strong></td>
              </tr>
              <tr>
                <td style="padding: 8px;">Received</td>
                <td style="padding: 8px; text-align: right;">₹ ${amountReceived.toFixed(2)}</td>
              </tr>
              <tr>
                <td style="padding: 8px;"><strong>Balance</strong></td>
                <td style="padding: 8px; text-align: right;"><strong>₹ ${balance.toFixed(2)}</strong></td>
              </tr>
            </table>
          </div>
        </div>
        
        <div class="signature-section">
          <div class="signature-placeholder"></div>
          <p><strong>For: Myrtille Industries</strong></p>
          <p>Authorized Signatory</p>
        </div>
        
        <div style="margin-top: 20px; font-size: 12px; color: #666; text-align: center;">
          Invoice No: ${document.getElementById('invoiceNumber').value} | Date: ${document.getElementById('invoiceDate').value}
        </div>
      `;
      
      document.getElementById('invoicePreview').innerHTML = invoiceHTML;
      document.getElementById('downloadPreviewBtn').style.display = 'flex';
    }
    
    // Function to generate invoice items HTML
    function generateInvoiceItemsHTML() {
      const rows = document.querySelectorAll('#itemsTableBody tr');
      let html = '';
      
      rows.forEach((row, index) => {
        const name = row.querySelector('.item-name').value;
        const hsn = row.querySelector('.item-hsn').value;
        const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
        const price = parseFloat(row.querySelector('.item-price').value) || 0;
        const gst = parseFloat(row.querySelector('.item-gst').value) || 0;
        
        const subtotal = quantity * price;
        const gstAmount = subtotal * (gst / 100);
        const total = subtotal + gstAmount;
        
        html += `
          <tr>
            <td>${index + 1}</td>
            <td>${name}</td>
            <td>${hsn}</td>
            <td>${quantity}</td>
            <td>₹ ${price.toFixed(2)}</td>
            <td>₹ ${gstAmount.toFixed(2)} (${gst}%)</td>
            <td>₹ ${total.toFixed(2)}</td>
          </tr>
        `;
      });
      
      return html;
    }
    
    // Function to generate invoice PDF
    async function generateInvoicePDF() {
      // Show status
      const statusArea = document.getElementById('statusArea');
      const progressBar = document.getElementById('progressBar');
      const statusMessage = document.getElementById('statusMessage');
      const successMessage = document.getElementById('successMessage');
      const errorMessage = document.getElementById('errorMessage');
      
      successMessage.style.display = 'none';
      errorMessage.style.display = 'none';
      statusArea.classList.add('active');
      statusMessage.textContent = "Starting PDF generation...";
      progressBar.style.width = "10%";
      
      try {
        // Create PDF document
        const pdfDoc = await PDFLib.PDFDocument.create();
        const page = pdfDoc.addPage([595.28, 841.89]); // A4 size
        
        // Load fonts
        const helveticaFont = await pdfDoc.embedFont(PDFLib.StandardFonts.Helvetica);
        const helveticaBoldFont = await pdfDoc.embedFont(PDFLib.StandardFonts.HelveticaBold);
        
        // Set initial coordinates
        let y = 800;
        
        // Add company header
        statusMessage.textContent = "Adding company details...";
        progressBar.style.width = "20%";
        
        page.drawText("Myrtille Industries", {
          x: 50,
          y: y,
          size: 24,
          font: helveticaBoldFont,
          color: PDFLib.rgb(0.1, 0.1, 0.1),
        });
        
        y -= 30;
        
        const companyAddress = "25 Deep Nagar, Near Gurjar ki Thari Jaipur (Raj) 302019";
        page.drawText(companyAddress, {
          x: 50,
          y: y,
          size: 10,
          font: helveticaFont,
          color: PDFLib.rgb(0.3, 0.3, 0.3),
        });
        
        y -= 15;
        
        const bankDetails = "A/C NO. 921020038756944 | IFSC CODE UTIB0002582 | Axis bank Swej farm Jaipur";
        page.drawText(bankDetails, {
          x: 50,
          y: y,
          size: 10,
          font: helveticaFont,
          color: PDFLib.rgb(0.3, 0.3, 0.3),
        });
        
        y -= 15;
        
        const contactDetails = "Phone no.: 9782099489 | Email: myrtilleindia@gmail.com";
        page.drawText(contactDetails, {
          x: 50,
          y: y,
          size: 10,
          font: helveticaFont,
          color: PDFLib.rgb(0.3, 0.3, 0.3),
        });
        
        y -= 15;
        
        const gstDetails = "GSTIN: 08AMHPY5013C1Z4 | State: 08-Rajasthan";
        page.drawText(gstDetails, {
          x: 50,
          y: y,
          size: 10,
          font: helveticaFont,
          color: PDFLib.rgb(0.3, 0.3, 0.3),
        });
        
        y -= 40;
        
        // Add invoice title
        page.drawText("Tax Invoice", {
          x: 250,
          y: y,
          size: 20,
          font: helveticaBoldFont,
          color: PDFLib.rgb(0.1, 0.1, 0.1),
        });
        
        y -= 40;
        
        // Add bill to section
        statusMessage.textContent = "Adding customer details...";
        progressBar.style.width = "30%";
        
        page.drawText("Bill To", {
          x: 50,
          y: y,
          size: 14,
          font: helveticaBoldFont,
          color: PDFLib.rgb(0.1, 0.1, 0.1),
        });
        
        y -= 20;
        
        const customerName = document.getElementById('customerName').value;
        page.drawText(customerName, {
          x: 50,
          y: y,
          size: 12,
          font: helveticaFont,
          color: PDFLib.rgb(0.1, 0.1, 0.1),
        });
        
        y -= 15;
        
        const customerAddress = document.getElementById('customerAddress').value;
        page.drawText(customerAddress, {
          x: 50,
          y: y,
          size: 10,
          font: helveticaFont,
          color: PDFLib.rgb(0.3, 0.3, 0.3),
        });
        
        y -= 15;
        
        const customerContact = `Contact No.: ${document.getElementById('customerContact').value}`;
        page.drawText(customerContact, {
          x: 50,
          y: y,
          size: 10,
          font: helveticaFont,
          color: PDFLib.rgb(0.3, 0.3, 0.3),
        });
        
        y -= 40;
        
        // Add table headers
        statusMessage.textContent = "Adding invoice items...";
        progressBar.style.width = "40%";
        
        const tableHeaders = ["#", "Item name", "HSN/ SAC", "Quantity", "Price/ unit", "GST", "Amount"];
        const columnWidths = [30, 180, 80, 60, 80, 80, 80];
        let x = 50;
        
        // Draw table header background
        page.drawRectangle({
          x: x - 5,
          y: y - 20,
          width: 500,
          height: 25,
          color: PDFLib.rgb(0.9, 0.9, 0.9),
        });
        
        // Draw table headers
        tableHeaders.forEach((header, index) => {
          page.drawText(header, {
            x: x,
            y: y,
            size: 10,
            font: helveticaBoldFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
          x += columnWidths[index];
        });
        
        y -= 30;
        
        // Add table rows
        const rows = document.querySelectorAll('#itemsTableBody tr');
        const totals = calculateInvoiceTotals();
        
        rows.forEach((row, index) => {
          const name = row.querySelector('.item-name').value;
          const hsn = row.querySelector('.item-hsn').value;
          const quantity = parseFloat(row.querySelector('.item-quantity').value) || 0;
          const price = parseFloat(row.querySelector('.item-price').value) || 0;
          const gst = parseFloat(row.querySelector('.item-gst').value) || 0;
          
          const subtotal = quantity * price;
          const gstAmount = subtotal * (gst / 100);
          const total = subtotal + gstAmount;
          
          // Draw row background for alternate rows
          if (index % 2 === 0) {
            page.drawRectangle({
              x: 45,
              y: y - 15,
              width: 510,
              height: 20,
              color: PDFLib.rgb(0.98, 0.98, 0.98),
            });
          }
          
          // Draw row data
          x = 50;
          
          page.drawText((index + 1).toString(), {
            x: x,
            y: y,
            size: 10,
            font: helveticaFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
          x += columnWidths[0];
          
          page.drawText(name, {
            x: x,
            y: y,
            size: 10,
            font: helveticaFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
          x += columnWidths[1];
          
          page.drawText(hsn, {
            x: x,
            y: y,
            size: 10,
            font: helveticaFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
          x += columnWidths[2];
          
          page.drawText(quantity.toString(), {
            x: x,
            y: y,
            size: 10,
            font: helveticaFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
          x += columnWidths[3];
          
          page.drawText(`₹ ${price.toFixed(2)}`, {
            x: x,
            y: y,
            size: 10,
            font: helveticaFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
          x += columnWidths[4];
          
          page.drawText(`₹ ${gstAmount.toFixed(2)} (${gst}%)`, {
            x: x,
            y: y,
            size: 10,
            font: helveticaFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
          x += columnWidths[5];
          
          page.drawText(`₹ ${total.toFixed(2)}`, {
            x: x,
            y: y,
            size: 10,
            font: helveticaFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
          
          y -= 20;
        });
        
        y -= 30;
        
        // Add amount in words
        statusMessage.textContent = "Adding invoice totals...";
        progressBar.style.width = "60%";
        
        const amountWords = numberToWords(totals.totalAmount);
        page.drawText(`Invoice Amount In Words: ${amountWords}`, {
          x: 50,
          y: y,
          size: 10,
          font: helveticaFont,
          color: PDFLib.rgb(0.1, 0.1, 0.1),
        });
        
        y -= 40;
        
        // Add terms and conditions
        const terms = document.getElementById('terms').value;
        page.drawText(`Terms and Conditions: ${terms}`, {
          x: 50,
          y: y,
          size: 10,
          font: helveticaFont,
          color: PDFLib.rgb(0.1, 0.1, 0.1),
        });
        
        y -= 60;
        
        // Add totals section
        const amountReceived = parseFloat(document.getElementById('amountReceived').value) || 0;
        const balance = parseFloat(totals.totalAmount) - amountReceived;
        
        const totalsData = [
          ["Sub Total", `₹ ${totals.subtotal}`],
          ["SGST @9%", `₹ ${(parseFloat(totals.totalGST) / 2).toFixed(2)}`],
          ["CGST @9%", `₹ ${(parseFloat(totals.totalGST) / 2).toFixed(2)}`],
          ["Total", `₹ ${totals.totalAmount}`],
          ["Received", `₹ ${amountReceived.toFixed(2)}`],
          ["Balance", `₹ ${balance.toFixed(2)}`]
        ];
        
        let totalsY = y + 80;
        
        totalsData.forEach(([label, value]) => {
          page.drawText(label, {
            x: 350,
            y: totalsY,
            size: 10,
            font: helveticaFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
          
          page.drawText(value, {
            x: 470,
            y: totalsY,
            size: 10,
            font: helveticaFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
          
          totalsY -= 15;
        });
        
        // Try to add signature image
        statusMessage.textContent = "Adding signature...";
        progressBar.style.width = "80%";
        
        try {
          // Try to load the signature image
          const signatureImageUrl = 'myrtille_signature.png';
          const signatureImageBytes = await fetch(signatureImageUrl)
            .then(res => {
              if (!res.ok) throw new Error('Signature image not found');
              return res.arrayBuffer();
            });
          
          const signatureImage = await pdfDoc.embedPng(signatureImageBytes);
          const signatureDims = signatureImage.scale(0.3);
          
          page.drawImage(signatureImage, {
            x: 400,
            y: 50,
            width: signatureDims.width,
            height: signatureDims.height,
          });
          
          page.drawText("For: Myrtille Industries", {
            x: 400,
            y: 30,
            size: 10,
            font: helveticaBoldFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
          
          page.drawText("Authorized Signatory", {
            x: 400,
            y: 15,
            size: 10,
            font: helveticaFont,
            color: PDFLib.rgb(0.3, 0.3, 0.3),
          });
        } catch (error) {
          console.log('Signature image not found, using text instead');
          
          // Draw signature placeholder
          page.drawRectangle({
            x: 400,
            y: 30,
            width: 150,
            height: 40,
            borderColor: PDFLib.rgb(0.7, 0.7, 0.7),
            borderWidth: 1,
          });
          
          page.drawText("Signature", {
            x: 425,
            y: 45,
            size: 12,
            font: helveticaFont,
            color: PDFLib.rgb(0.5, 0.5, 0.5),
          });
          
          page.drawText("For: Myrtille Industries", {
            x: 400,
            y: 15,
            size: 10,
            font: helveticaBoldFont,
            color: PDFLib.rgb(0.1, 0.1, 0.1),
          });
        }
        
        // Add invoice number and date at bottom
        const invoiceNumber = document.getElementById('invoiceNumber').value;
        const invoiceDate = document.getElementById('invoiceDate').value;
        
        page.drawText(`Invoice No: ${invoiceNumber} | Date: ${invoiceDate}`, {
          x: 50,
          y: 30,
          size: 10,
          font: helveticaFont,
          color: PDFLib.rgb(0.5, 0.5, 0.5),
        });
        
        // Save PDF
        statusMessage.textContent = "Finalizing PDF...";
        progressBar.style.width = "95%";
        
        const pdfBytes = await pdfDoc.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        
        // Generate filename
        const invoiceNumberClean = invoiceNumber.replace(/[^a-zA-Z0-9]/g, '_');
        const filename = `Myrtille_Invoice_${invoiceNumberClean}.pdf`;
        
        // Save file
        saveAs(blob, filename);
        
        statusMessage.textContent = "Invoice generated successfully!";
        progressBar.style.width = "100%";
        
        setTimeout(() => {
          statusArea.classList.remove('active');
          successMessage.style.display = 'block';
          setTimeout(() => {
            successMessage.style.display = 'none';
          }, 4000);
        }, 1000);
        
      } catch (error) {
        console.error('Error generating PDF:', error);
        document.getElementById('errorText').textContent = `Error generating PDF: ${error.message}`;
        errorMessage.style.display = 'block';
        statusArea.classList.remove('active');
      }
    }
    
    // Function to reset form
    function resetForm() {
      if (confirm("Are you sure you want to reset the form? All data will be lost.")) {
        document.getElementById('invoiceForm').reset();
        document.getElementById('invoiceDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('itemsTableBody').innerHTML = '';
        document.getElementById('invoicePreview').innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">Fill the form and click "Preview Invoice" to see a preview here.</p>';
        document.getElementById('downloadPreviewBtn').style.display = 'none';
        addItemRow();
        addSampleData();
      }
    }
    
    // Function to add sample data for demo
    function addSampleData() {
      // Set sample customer data
      document.getElementById('customerName').value = "SUPERINTENDENT CUM MEMBER SECRETARY RMRS";
      document.getElementById('customerAddress').value = "SUPER SPECIALITY HOSPITAL, RNT MEDICAL COLLEGE, UDAIPUR";
      document.getElementById('customerContact').value = "9829851042";
      
      // Clear any existing rows and add sample item
      document.getElementById('itemsTableBody').innerHTML = '';
      addItemRow({
        name: "RAT AND PEST CONTROL",
        hsn: "",
        quantity: 1,
        price: 35416,
        gst: 18
      });
    }
  </script>
</body>
</html>
